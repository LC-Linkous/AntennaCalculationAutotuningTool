# ----------------------------------------------------
 # ANSYS HFSS script generated by AntennaCAT version 2.0 
# 14/07/2023 23:05:52
# ----------------------------------------------------
# microstrip patch antenna generated through GUI
# ----------------------------------------------------

import ScriptEnv 

projectSaveLoc="C:/Users/linkouslc/Desktop/GeneratedHFSSProject.aedt"
saveBase="C:/Users/linkouslc/Desktop/BatchData/"

ScriptEnv.Initialize("Ansoft.ElectronicsDesktop") 
oDesktop.RestoreWindow() 
oProject = oDesktop.NewProject() 
oProject.InsertDesign("HFSS", "HFSSDesign1", "HFSS Terminal Network", "") 
oProject.SaveAs(projectSaveLoc, True) 

oProject.ChangeProperty( 
[ 
"NAME:AllTabs", 
[ 
"NAME:ProjectVariableTab", 
[ 
"NAME:PropServers", 
"ProjectVariables" 
], 
[ 
"NAME:NewProps", 
[ 
"NAME:$width", 
"PropType:=" , "VariableProp", 
"UserDef:=" , True, 
"Value:=" , "0.03803628871563654" 
], 
[ 
"NAME:$length", 
"PropType:=" , "VariableProp", 
"UserDef:=" , True, 
"Value:=" , "0.029442361217936117" 
], 
[ 
"NAME:$ground_plane", 
"PropType:=" , "VariableProp", 
"UserDef:=" , True, 
"Value:=" , "2*$length" 
], 
[ 
"NAME:$depth", 
"PropType:=" , "VariableProp", 
"UserDef:=" , True, 
"Value:=" , "1.6e-3" 
], 
[ 
"NAME:$strip_width", 
"PropType:=" , "VariableProp", 
"UserDef:=" , True, 
"Value:=" , "0.003058974982927644" 
], 
[ 
"NAME:$x_0", 
"PropType:=" , "VariableProp", 
"UserDef:=" , True, 
"Value:=" , "$length/4" 
], 
[ 
"NAME:$gap", 
"PropType:=" , "VariableProp", 
"UserDef:=" , True, 
"Value:=" , "1 mm" 
] 
] 
] 
]) 
oDesign = oProject.SetActiveDesign("HFSSDesign1") 
oEditor = oDesign.SetActiveEditor("3D Modeler") 

# create ground plane 
oEditor.CreateRectangle( 
[ 
"NAME:RectangleParameters", 
"IsCovered:=" , True, 
"XStart:=" , "-$ground_plane/2", 
"YStart:=" , "-$ground_plane/2", 
"ZStart:=" , "-$depth", 
"Width:=" , "$ground_plane", 
"Height:=" , "$ground_plane", 
"WhichAxis:=" , "Z" 
], 
[ 
"NAME:Attributes", 
"Name:=" , "ground_plane", 
"Flags:=" , "", 
"Color:=" , "(225 225 128)", 
"Transparency:=" , 0, 
"PartCoordinateSystem:=", "Global", 
"UDMId:=" , "", 
"MaterialValue:=" , "\"copper\"" , 
"SurfaceMaterialValue:=", "\"\"", 
"SolveInside:=" , True, 
"ShellElement:=" , False, 
"ShellElementThickness:=", "0mm", 
"IsMaterialEditable:=" , True, 
"UseMaterialAppearance:=", False, 
"IsLightweight:=" , False 
]) 

# create substrate 
oEditor.CreateBox( 
[ 
"NAME:BoxParameters", 
"XPosition:=" , "-$ground_plane/2", 
"YPosition:=" , "-$ground_plane/2", 
"ZPosition:=" , "-$depth", 
"XSize:=" , "$ground_plane", 
"YSize:=" , "$ground_plane", 
"ZSize:=" , "$depth" 
], 
[ 
"NAME:Attributes", 
"Name:=" , "substrate", 
"Flags:=" , "", 
"Color:=" , "(143 175 143)", 
"Transparency:=" , 0, 
"PartCoordinateSystem:=", "Global", 
"UDMId:=" , "", 
"MaterialValue:=" , INSERT_SUBSTRATE_MATERIAL , 
"SurfaceMaterialValue:=", "\"\"", 
"SolveInside:=" , True, 
"ShellElement:=" , False, 
"ShellElementThickness:=", "0mm", 
"IsMaterialEditable:=" , True, 
"UseMaterialAppearance:=", False, 
"IsLightweight:=" , False 
]) 

# create patch 
oEditor.CreateRectangle( 
[ 
"NAME:RectangleParameters", 
"IsCovered:=" , True, 
"XStart:=" , "-$width/2", 
"YStart:=" , "-$length/2", 
"ZStart:=" , "0mm", 
"Width:=" , "$width", 
"Height:=" , "$length", 
"WhichAxis:=" , "Z" 
], 
[ 
"NAME:Attributes", 
"Name:=" , "patch", 
"Flags:=" , "", 
"Color:=" , "(225 225 128)", 
"Transparency:=" , 0, 
"PartCoordinateSystem:=", "Global", 
"UDMId:=" , "", 
"MaterialValue:=" , "\"copper\"" , 
"SurfaceMaterialValue:=", "\"\"", 
"SolveInside:=" , True, 
"ShellElement:=" , False, 
"ShellElementThickness:=", "0mm", 
"IsMaterialEditable:=" , True, 
"UseMaterialAppearance:=", False, 
"IsLightweight:=" , False 
]) 

#create offset 
oEditor = oDesign.SetActiveEditor("3D Modeler") 
oEditor.CreateRectangle( 
[ 
"NAME:RectangleParameters", 
"IsCovered:=" , True, 
"XStart:=" , "-$strip_width/2-$gap", 
"YStart:=" , "$length/2", 
"ZStart:=" , "0mm", 
"Width:=" , "$strip_width+2*$gap", 
"Height:=" , "-$x_0", 
"WhichAxis:=" , "Z" 
], 
[ 
"NAME:Attributes", 
"Name:=" , "offset", 
"Flags:=" , "", 
"Color:=" , "(143 175 143)", 
"Transparency:=" , 0, 
"PartCoordinateSystem:=", "Global", 
"UDMId:=" , "", 
"MaterialValue:=" , "\"vacuum\"", 
"SurfaceMaterialValue:=", "\"\"", 
"SolveInside:=" , True, 
"ShellElement:=" , False, 
"ShellElementThickness:=", "0mm", 
"IsMaterialEditable:=" , True, 
"UseMaterialAppearance:=", False, 
"IsLightweight:=" , False 
]) 
oEditor = oDesign.SetActiveEditor("3D Modeler") 
oEditor.Subtract( 
[ 
"NAME:Selections", 
"Blank Parts:=" , "patch", 
"Tool Parts:=" , "offset" 
], 
[ 
"NAME:SubtractParameters", 
"KeepOriginals:=" , False 
]) 
oEditor.CreateRectangle( 
[ 
"NAME:RectangleParameters", 
"IsCovered:=" , True, 
"XStart:=" , "-$strip_width/2", 
"YStart:=" , "$ground_plane/2", 
"ZStart:=" , "0mm", 
"Width:=" , "$strip_width", 
"Height:=" , "-(($ground_plane-$length)/2+$x_0)", 
"WhichAxis:=" , "Z" 
], 
[ 
"NAME:Attributes", 
"Name:=" , "strip_line", 
"Flags:=" , "", 
"Color:=" , "(225 225 128)", 
"Transparency:=" , 0, 
"PartCoordinateSystem:=", "Global", 
"UDMId:=" , "", 
"MaterialValue:=" , "\"copper\"" , 
"SurfaceMaterialValue:=", "\"\"", 
"SolveInside:=" , True, 
"ShellElement:=" , False, 
"ShellElementThickness:=", "0mm", 
"IsMaterialEditable:=" , True, 
"UseMaterialAppearance:=", False, 
"IsLightweight:=" , False 
]) 

oModule = oDesign.GetModule("BoundarySetup") 
oModule.AssignFiniteCond( 
[ 
"NAME:FiniteCond1", 
"Objects:=" , ["patch","strip_line","ground_plane"], 
"UseMaterial:=" , True, 
"Material:=" , "copper" , 
"UseThickness:=" , False, 
"Roughness:=" , "0um", 
"InfGroundPlane:=" , False, 
"IsTwoSided:=" , False, 
"IsInternal:=" , True 
]) 
oEditor = oDesign.SetActiveEditor("3D Modeler") 
oEditor.CreateRectangle( 
[ 
"NAME:RectangleParameters", 
"IsCovered:=" , True, 
"XStart:=" , "-$strip_width/2", 
"YStart:=" , "$ground_plane/2", 
"ZStart:=" , "0mm", 
"Width:=" , "-$depth", 
"Height:=" , "$strip_width", 
"WhichAxis:=" , "Y" 
], 
[ 
"NAME:Attributes", 
"Name:=" , "port", 
"Flags:=" , "", 
"Color:=" , "(143 175 143)", 
"Transparency:=" , 0, 
"PartCoordinateSystem:=", "Global", 
"UDMId:=" , "", 
"MaterialValue:=" , "\"vacuum\"", 
"SurfaceMaterialValue:=", "\"\"", 
"SolveInside:=" , True, 
"ShellElement:=" , False, 
"ShellElementThickness:=", "0mm", 
"IsMaterialEditable:=" , True, 
"UseMaterialAppearance:=", False, 
"IsLightweight:=" , False 
]) 

oEditor = oDesign.SetActiveEditor("3D Modeler") 
oEditor.CreateBox( 
[ 
"NAME:BoxParameters", 
"XPosition:=" , "-$ground_plane", 
"YPosition:=" , "-$ground_plane", 
"ZPosition:=" , "-$ground_plane", 
"XSize:=" , "$ground_plane*2", 
"YSize:=" , "$ground_plane*2", 
"ZSize:=" , "$ground_plane*2" 
], 
[ 
"NAME:Attributes", 
"Name:=" , "air_box", 
"Flags:=" , "", 
"Color:=" , "(128 255 255)", 
"Transparency:=" , 0.95, 
"PartCoordinateSystem:=", "Global", 
"UDMId:=" , "", 
"MaterialValue:=" , "\"vacuum\"", 
"SurfaceMaterialValue:=", "\"\"", 
"SolveInside:=" , True, 
"ShellElement:=" , False, 
"ShellElementThickness:=", "0mm", 
"IsMaterialEditable:=" , True, 
"UseMaterialAppearance:=", False, 
"IsLightweight:=" , False 
]) 
oModule.AssignRadiation( 
[ 
"NAME:Rad1", 
"Objects:=" , ["air_box"] 
]) 
oModule = oDesign.GetModule("BoundarySetup") 
oModule.AutoIdentifyPorts( 
[ 
"NAME:Faces", 
102 ## edit this 
], False, 
[ 
"NAME:ReferenceConductors", 
"strip_line" 
], "1", False) 

oProject.Save() 
#end antenna generation 


oModule = oDesign.GetModule("RadField") 
oModule.InsertInfiniteSphereSetup( 
[ 
"NAME:Infinite Sphere1", 
"UseCustomRadiationSurface:=", False, 
"CSDefinition:=" , "Theta-Phi", 
"Polarization:=" , "Linear", 
"ThetaStart:=" , "0deg", 
"ThetaStop:=" , "180deg", 
"ThetaStep:=" , "2deg", 
"PhiStart:=" , "-180deg", 
"PhiStop:=" , "180deg", 
"PhiStep:=" , "2deg", 
"UseLocalCS:=" , False 
]) 
oModule = oDesign.GetModule("AnalysisSetup") 
oModule.InsertSetup("HfssDriven", 
[ 
"NAME:Setup1", 
"SolveType:=" , "Single", 
"Frequency:=" , INSERT_FREQUENCY , 
"MaxDeltaS:=" , 0.02, 
"UseMatrixConv:=" , False, 
"MaximumPasses:=" , 6, 
"MinimumPasses:=" , 1, 
"MinimumConvergedPasses:=", 1, 
"PercentRefinement:=" , 30, 
"IsEnabled:=" , True, 
[ 
"NAME:MeshLink", 
"ImportMesh:=" , False 
], 
"BasisOrder:=" , 1, 
"DoLambdaRefine:=" , True, 
"DoMaterialLambda:=" , True, 
"SetLambdaTarget:=" , False, 
"Target:=" , 0.3333, 
"UseMaxTetIncrease:=" , False, 
"PortAccuracy:=" , 2, 
"UseABCOnPort:=" , False, 
"SetPortMinMaxTri:=" , False, 
"DrivenSolverType:=" , "Direct Solver", 
"EnhancedLowFreqAccuracy:=", False, 
"SaveRadFieldsOnly:=" , False, 
"SaveAnyFields:=" , True, 
"IESolverType:=" , "Auto", 
"LambdaTargetForIESolver:=", 0.15, 
"UseDefaultLambdaTgtForIESolver:=", True, 
"IE Solver Accuracy:=" , "Balanced", 
"InfiniteSphereSetup:=" , "" 
]) 
oModule.InsertFrequencySweep("Setup1", 
[ 
"NAME:Sweep", 
"IsEnabled:=" , True, 
"RangeType:=" , "LinearCount", 
"RangeStart:="		, INSERT_RANGE_START ,
"RangeEnd:="		, INSERT_RANGE_END ,
"RangeCount:=" , INSERT_RANGE_COUNT_INT ,
"Type:=" , "Interpolating", 
"SaveFields:=" , False, 
"SaveRadFields:=" , False, 
"InterpTolerance:=" , 0.5, 
"InterpMaxSolns:=" , 250, 
"InterpMinSolns:=" , 0, 
"InterpMinSubranges:=" , 1, 
"InterpUseS:=" , True, 
"InterpUsePortImped:=" , True, 
"InterpUsePropConst:=" , True, 
"UseDerivativeConvergence:=", False, 
"InterpDerivTolerance:=", 0.2, 
"UseFullBasis:=" , True, 
"EnforcePassivity:=" , True, 
"PassivityErrorTolerance:=", 0.0001, 
"EnforceCausality:=" , False, 
"SMatrixOnlySolveMode:=", "Auto" 
]) 
